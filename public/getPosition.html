<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">

    <body>

    <button onclick="tryGeolocation()">Try It</button>

    <div id="map"></div>

    <style>
      #map {
        height: 100%;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>

    <script>

      //var positionHng = document.getElementById("position-hng");
      var output = document.querySelector('.output');
      var arr = document.getElementById("arrow");

      var minDist = 0.006;
      var coordinates = [];
      var coordinateIndex = 0;

      var bearing = 0;
      var currLat = 0;
      var currLong = 0;
      var map;
      var target;

      //Function called by async script call at bottom
      function initMap() {
        var myLatLng = {lat: -25.363, lng: 131.044};

         map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          center: myLatLng
        });

        var home = new google.maps.Marker({
          position: myLatLng,
          map: map,
          title: 'CurrLoc!'
        });

        target = new google.maps.Marker({
          position: myLatLng,
          map: map,
          title: 'Target!'
        });
      }

      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
              processXML(this);
          }
      };

      //process variable from drop down
      function changeInput (objDropDown)
      {
          var obj = document.getElementById("dropdown");
          obj.value = objDropDown.value;
          console.log(obj.value);

          //open one of the xml files with coordinates
          xhttp.open("GET", obj.value, true);
          xhttp.send();

      }

      var coordIndex = 0;

      function processXML(xml) {

          var xmlDoc = xml.responseXML;
          var temp = "";
          coordinates.splice(0);
          coordIndex = 0;

          var tempCoords = xmlDoc.getElementsByTagName("coordinates")[0].childNodes[0].nodeValue;

          for(var i = 0; i < tempCoords.length; i ++){

            if(tempCoords[i] === ','){

              coordinates.push([]);
              coordinates[coordIndex] = temp;
              coordIndex ++;

              console.log(temp);
              //console.log(tempCoords[i]);
              temp = "";

            }else{
              temp = "" + temp + tempCoords[i];
            }
          }
      }

      //Get location of device  - navigator is just an html5 access for the browser
      var tryGeolocation = function() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(
            browserGeolocationSuccess,
            browserGeolocationFail, { enableHighAccuracy: true, timeout: 5000, maximumAge: 0});
          //  {maximumAge: 0, timeout: 5000, enableHighAccuracy: false});
        }
      };


      //Geolocation stuff
      var browserGeolocationSuccess = function(position) {
      //alert("Browser geolocation success!\n\nlat = " + position.coords.latitude + "\nlng = " + position.coords.longitude);
         var myLatLng = {lat: position.coords.latitude, lng: position.coords.longitude};

         currLat = position.coords.latitude;
         currLong = position.coords.longitude;

          //update google map with position
          // map = new google.maps.Map(document.getElementById('map'), {
          // zoom: 18,
          // center: myLatLng
          // });

          marker = new google.maps.Marker({
            position: myLatLng,
            map: map,
            title: 'Your Position!'
          });




      };

      //Process errors for geoloc
      var browserGeolocationFail = function(error) {
        switch (error.code) {
          case error.TIMEOUT:
            alert("Browser geolocation error !\n\nTimeout.");
            break;
          case error.PERMISSION_DENIED:
            alert("Permission Denied");
            break;
          case error.POSITION_UNAVAILABLE:
            alert("Browser geolocation error !\n\nPosition unavailable AGAIN");
            break;
        }
      };

     //get device orientation events
    // window.addEventListener("deviceorientation", onHeadingChange, true);

    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOkPz6eU_-nO5OKT_Yhv1Rkxu-gOEwKwU&callback=initMap">
    </script>


  </body>
</html>
